# Figure 1: InvisibleBench Evaluation Pipeline

direction: right

# Input
input: "User Input\nTranscript" {
  shape: rectangle
  style: {
    fill: "#FFE8D6"
    stroke: "#54340E"
    border-radius: 8
  }
}

# Scenario tiers (grouped)
tiers: Scenarios {
  style: {
    fill: "#FFF7EF"
    stroke: "#CB997E"
    border-radius: 8
  }

  tier3: "Tier 3\n20+ turns" {
    style: {
      fill: "#FFFFFF"
      stroke: "#FF9F1C"
      stroke-width: 2
      border-radius: 6
    }
  }

  tier2: "Tier 2\n8–12 turns" {
    style: {
      fill: "#FFFFFF"
      stroke: "#54340E"
      border-radius: 6
    }
  }

  tier1: "Tier 1\n3–5 turns" {
    style: {
      fill: "#FFFFFF"
      stroke: "#54340E"
      border-radius: 6
    }
  }
}

# Processing pipeline
guardrails: "Guardrails\nAutofail checks" {
  style: {
    fill: "#FFFFFF"
    stroke: "#CB997E"
    stroke-width: 2
    border-radius: 8
  }
}

judges: "LLM Judges\n3× per dim" {
  style: {
    fill: "#FFFFFF"
    stroke: "#FFBF68"
    stroke-width: 2
    border-radius: 8
  }
}

aggregator: "Aggregator\nMedian score" {
  style: {
    fill: "#FFFFFF"
    stroke: "#54340E"
    stroke-width: 2
    border-radius: 8
  }
}

# Decision gate
gate: Gate {
  shape: diamond
  style: {
    fill: "#FFFFFF"
    stroke: "#54340E"
  }
}

# Outcomes
pass: "PASS\n≥70%" {
  style: {
    fill: "#E8F5E9"
    stroke: "#2E7D32"
    stroke-width: 2
    border-radius: 8
  }
}

review: "REVIEW\n50–70%" {
  style: {
    fill: "#FFF2E0"
    stroke: "#F6A14D"
    stroke-width: 2
    border-radius: 8
  }
}

fail: "FAIL\nAutofail" {
  style: {
    fill: "#FDECEC"
    stroke: "#C62828"
    stroke-width: 2
    border-radius: 8
  }
}

# Flow connections
input -> tiers
tiers -> guardrails
guardrails -> judges
judges -> aggregator
aggregator -> gate

gate -> pass: { style.stroke: "#2E7D32" }
gate -> review: { style.stroke: "#F6A14D" }
gate -> fail: { style.stroke: "#C62828" }
