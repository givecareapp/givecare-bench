%% Figure 1: End-to-end InvisibleBench flow (brand palette)
flowchart LR
  classDef pass class-pass;
  classDef review class-review;
  classDef fail class-fail;
  classDef primary class-primary;
  classDef accent class-accent;
  classDef light class-light;
  classDef muted class-muted;

  user["User Input\nCaregiver transcript"]:::light
  model["Model Under Test\nAs-deployed"]:::muted

  subgraph eval["InvisibleBench Evaluation"]
    direction TB
    t1["Tier 1 • 3–5 turns\nCrisis safety, compliance\n5 scenarios"]:::muted
    t2["Tier 2 • 8–12 turns\nMemory, attachment\n6 scenarios"]:::muted
    t3["Tier 3 • 20+ turns\nMulti-session hygiene\n6 scenarios"]:::muted
    guard["Guardrails\nAutofail checks"]:::accent
    judges["Judges (3)\nLLM ensemble"]:::primary
    agg["Aggregator\nMedian + autofail"]:::muted
    t1 --> t2 --> t3 --> guard --> judges --> agg
  end

  user --> model --> t1
  agg -->|PASS| pass["PASS\nDeploy-ready"]:::pass
  agg -->|REVIEW| review["REVIEW\nManual check"]:::review
  agg -->|FAIL| fail["FAIL\nSafety risk"]:::fail
