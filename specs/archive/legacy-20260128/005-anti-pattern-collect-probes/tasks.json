{
  "spec": "005-anti-pattern-collect-probes",
  "tasks": [
    {
      "id": "T-001",
      "title": "Investigate duplicate _collect_probes implementations",
      "description": "Read both memory.py and trauma.py scorer files to confirm the duplicated _collect_probes() implementations, understand their signatures, return types, and any subtle differences. Also identify the existing module structure for shared utilities.",
      "acceptanceCriteria": [
        "File `benchmark/invisiblebench/evaluation/scorers/memory.py` exists and contains `_collect_probes` between lines 16-25",
        "File `benchmark/invisiblebench/evaluation/scorers/trauma.py` exists and contains `_collect_probes` between lines 24-33",
        "grep -r '_collect_probes' benchmark/invisiblebench/evaluation/scorers/ — returns 2 or more matches"
      ],
      "passes": false
    },
    {
      "id": "T-002",
      "title": "Identify or create shared utility module for scorer helpers",
      "description": "Determine if a shared utility module already exists under the scorers package (e.g., utils.py, base.py, common.py). If none exists, identify the correct location following existing code patterns.",
      "acceptanceCriteria": [
        "Run `ls benchmark/invisiblebench/evaluation/scorers/` — exits with code 0 and output is documented for downstream tasks"
      ],
      "passes": false
    },
    {
      "id": "T-003",
      "title": "Extract _collect_probes into shared utility module",
      "description": "Move the _collect_probes() function into a shared module within the scorers package (e.g., utils.py or base.py), preserving its exact signature, logic, and return type. Add necessary imports.",
      "acceptanceCriteria": [
        "File `benchmark/invisiblebench/evaluation/scorers/utils.py` contains `def _collect_probes` or file `benchmark/invisiblebench/evaluation/scorers/base.py` contains `def _collect_probes`",
        "Run `python -m py_compile benchmark/invisiblebench/evaluation/scorers/utils.py` — exits with code 0 (or the equivalent base.py path)"
      ],
      "passes": false
    },
    {
      "id": "T-004",
      "title": "Update memory.py to import shared _collect_probes",
      "description": "Replace the local _collect_probes() implementation in memory.py with an import from the shared utility module. Remove the duplicated function body.",
      "acceptanceCriteria": [
        "File `benchmark/invisiblebench/evaluation/scorers/memory.py` contains `from` and `_collect_probes`",
        "File `benchmark/invisiblebench/evaluation/scorers/memory.py` no longer contains a local `def _collect_probes` definition",
        "Run `python -m py_compile benchmark/invisiblebench/evaluation/scorers/memory.py` — exits with code 0"
      ],
      "passes": false
    },
    {
      "id": "T-005",
      "title": "Update trauma.py to import shared _collect_probes",
      "description": "Replace the local _collect_probes() implementation in trauma.py with an import from the shared utility module. Remove the duplicated function body.",
      "acceptanceCriteria": [
        "File `benchmark/invisiblebench/evaluation/scorers/trauma.py` contains `from` and `_collect_probes`",
        "File `benchmark/invisiblebench/evaluation/scorers/trauma.py` no longer contains a local `def _collect_probes` definition",
        "Run `python -m py_compile benchmark/invisiblebench/evaluation/scorers/trauma.py` — exits with code 0"
      ],
      "passes": false
    },
    {
      "id": "T-006",
      "title": "Verify no duplicate _collect_probes definitions remain",
      "description": "Confirm that _collect_probes is defined exactly once in the codebase (in the shared utility module) and only imported elsewhere.",
      "acceptanceCriteria": [
        "Run `grep -rn 'def _collect_probes' benchmark/invisiblebench/evaluation/scorers/` — returns exactly 1 match",
        "Run `grep -rn '_collect_probes' benchmark/invisiblebench/evaluation/scorers/` — returns 3 matches (1 definition + 2 imports)"
      ],
      "passes": false
    },
    {
      "id": "T-007",
      "title": "Run full test suite and compilation check",
      "description": "Execute the project's test suite and compile-check all Python files to ensure no regressions were introduced by the refactor.",
      "acceptanceCriteria": [
        "Run `python -m py_compile benchmark/invisiblebench/evaluation/scorers/memory.py` — exits with code 0",
        "Run `python -m py_compile benchmark/invisiblebench/evaluation/scorers/trauma.py` — exits with code 0",
        "Run `cd /home/deploy/gc-repos/givecare-bench && pytest --tb=short -q 2>/dev/null || echo 'no pytest'` — exits with code 0 and does not contain 'FAILED'"
      ],
      "passes": false
    }
  ]
}
